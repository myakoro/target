# 開催日の自動判定 - 実装ガイド

## 🎯 課題

12月7日のように、開催数が日によって異なる（2開催、3開催、4開催など）場合、どうやって全ての開催会場を自動的に処理するか？

## ✅ 解決方法: UI要素の自動取得

Power Automate for Desktopの**「UI要素を検索」**機能を使用します。

## 📝 実装手順

### ステップ1: 開催日一覧のUI要素を取得

**アクション追加:**
```
アクション: UI要素を検索
- ウィンドウ: TARGET
- 検索対象: 開催日一覧の各行
- 結果を格納: %VenueElements%
```

これで、画面上の全ての開催会場（中山、阪神、中京など）が自動的にリストとして取得されます。

### ステップ2: For Eachループで処理

```
アクション: For Each
- 値: %VenueElements%
- 現在の項目: %CurrentVenue%

ループ内:
  1. %CurrentVenue% をダブルクリック
  2. レースループ（1-12）
     - レース処理
  3. 次の開催会場へ
```

## 🚀 修正版フロー構造

```
1. TARGET起動
2. 成績ボタン → 開催名タブ → 年選択

3. 開催日一覧のUI要素を取得
   → %VenueElements% = [中山, 阪神, 中京]（自動）

4. For Each %CurrentVenue% in %VenueElements%
   ├─ %CurrentVenue% をダブルクリック（ステップ5）
   │
   ├─ For RaceIndex = 1 to 12
   │  ├─ レース選択（ステップ6）
   │  ├─ オッズ処理（ステップ7-9）
   │  ├─ CSV出力（ステップ10-13）
   │  └─ 閉じる（ステップ14）
   │
   └─ 次の開催会場へ
```

## 💡 実装のコツ

### UI要素の取得方法

1. **デスクトップレコーダーで記録:**
   - 1番目の開催会場（例: 中山）をダブルクリック
   - レコーダー停止

2. **UI要素セレクターを確認:**
   ```
   例: <row index='1' text='中山' />
   ```

3. **「UI要素を検索」アクションに変換:**
   - セレクターから `index='1'` を削除
   - `text='*'` に変更（全ての行を取得）
   - または、親要素の全子要素を取得

### 具体的な実装

**Power Automate for Desktopでの操作:**

1. **アクション追加: 「UI要素を検索」**
   - 左パネル「アクション」→「UI オートメーション」→「UI要素を検索」

2. **設定:**
   - UI要素: 開催日一覧の親要素を選択
   - 検索条件: 全ての子要素（行）
   - 結果: `%VenueElements%`

3. **For Eachループ追加:**
   - 左パネル「アクション」→「ループ」→「For Each」
   - 値: `%VenueElements%`
   - 現在の項目: `%CurrentVenue%`

4. **ループ内で開催会場をクリック:**
   - `%CurrentVenue%` をダブルクリック

## 📊 動作イメージ

### 12月7日（3開催の場合）

```
UI要素取得 → [中山, 阪神, 中京]

For Each:
  1回目: 中山
    → 12レース処理
  2回目: 阪神
    → 12レース処理
  3回目: 中京
    → 12レース処理

完了！
```

### 12月8日（2開催の場合）

```
UI要素取得 → [中京, 阪神]

For Each:
  1回目: 中京
    → 12レース処理
  2回目: 阪神
    → 12レース処理

完了！
```

**開催数に関わらず自動対応！**

## 🎯 修正版クイックスタート

### ステップ1: 初期化部分を記録

```
1. TARGET起動
2. 成績ボタン
3. 開催名タブ
4. 2025年選択
```

### ステップ2: UI要素取得アクションを追加

**手動でアクション追加:**
1. 「UI要素を検索」アクション
2. 開催日一覧の全行を取得
3. 結果: `%VenueElements%`

### ステップ3: 1開催・1レース分を記録

```
5. 1番目の開催会場をダブルクリック
6-14. 1レース分の処理
```

### ステップ4: ループ化

1. **レースループ（内側）:**
   - ステップ6-14をループで囲む（1 to 12）

2. **開催日ループ（外側）:**
   - ステップ5 + レースループを「For Each」で囲む
   - 値: `%VenueElements%`

## ⚠️ 注意事項

### UI要素の取得タイミング

- 年選択（ステップ4）の**直後**にUI要素を取得
- 開催日一覧が表示された状態で取得

### セレクターの調整

取得したUI要素が正しくない場合:
- セレクターを調整
- または、画像認識に切り替え

## 🎓 代替案: 固定リスト

UI要素取得が難しい場合、手動で指定も可能:

```
入力変数: VenueList
データ型: List
既定値: ["中山", "阪神", "中京"]
```

ただし、開催数が変わるたびに手動更新が必要。

## 📞 推奨実装

**UI要素の自動取得を推奨します。**

理由:
- 開催数の変動に自動対応
- 開催会場名も自動取得
- メンテナンス不要

---

**結論: 開催数が何個でも、自動的に全て処理できます！**

# Power Automate フロー修正ガイド

## 📋 現在のフロー状態

記録されたアクション（19ステップ）:
- ✅ TARGET起動
- ✅ 成績ボタン、開催名タブ
- ✅ 2025年選択
- ✅ 各種パネル操作
- ⚠️ **ステップ12: JVオッズ取得ボタン（コメントのみ）**
- ✅ CSV出力メニュー選択
- ✅ OKボタン、閉じる×2

## 🔧 修正手順

### 修正1: JVオッズ取得ボタンを追加

**ステップ12（コメント）の直後にアクションを追加:**

1. **ステップ12とステップ13の間をクリック**
2. **左パネル「アクション」→「UI オートメーション」→「ウィンドウ内のボタンを押す」**
3. **UI要素を選択:**
   - 「UI要素の選択」をクリック
   - TARGETウィンドウの「JVオッズ取得」ボタンをクリック

**もしUI要素が認識されない場合:**

**方法A: 画像認識を使用**
1. アクション「ウィンドウ内の画像をクリック」を追加
2. 「画像をキャプチャ」でJVオッズ取得ボタンを選択
3. 一致精度: 90%

**方法B: 座標を使用（最終手段）**
1. アクション「マウスをクリック」を追加
2. JVオッズ取得ボタンの座標を指定

### 修正2: 待機時間を追加

**JVオッズ取得ボタンの直後に待機を追加:**

1. **左パネル「アクション」→「フロー制御」→「待機」**
2. **待機時間: 30秒**（重要！）

### 修正3: レース選択と開催日選択を確認

**フローの中で以下が記録されているか確認:**
- 開催日（例: 中山）の選択
- レース（例: 1R）の選択

**もし記録されていない場合:**
1. デスクトップレコーダーを再起動
2. 該当部分のみを追加で記録

## 🔄 ループ化（次のステップ）

修正が完了したら、ループ化を行います。

### レースループ（内側）

**対象ステップ:**
- レース選択（例: ステップ9）
- ～
- 閉じる×2（ステップ18）

**手順:**
1. 該当ステップを全て選択（Shiftキー + クリック）
2. 右クリック → 「ループで囲む」
3. ループ設定:
   - 種類: **Loop**
   - 開始: `1`
   - 終了: `12`
   - インデックス: `RaceIndex`

4. レース選択アクションを編集:
   - UI要素セレクターを開く
   - インデックス部分を `%RaceIndex%` に変更

### 開催日ループ（外側）

**手順:**
1. 開催日選択 + レースループ全体を選択
2. 右クリック → 「ループで囲む」
3. ループ設定:
   - 種類: **For Each**
   - リスト: `VenueElements`（UI要素を検索で取得）

## 📝 完成イメージ

```
1. TARGET起動
2-5. 初期化（成績ボタン、開催名タブ、年選択）

6. UI要素を検索（開催日一覧）
   → %VenueElements%

7. For Each %CurrentVenue% in %VenueElements%
   ├─ 開催日をダブルクリック
   │
   ├─ Loop (RaceIndex = 1 to 12)
   │  ├─ レース選択（%RaceIndex%番目）
   │  ├─ オッズボタン
   │  ├─ 単複時系タブ
   │  ├─ JVオッズ取得 ← 修正箇所
   │  ├─ 待機（30秒）← 追加
   │  ├─ ファイル→CSV出力
   │  ├─ OKボタン
   │  └─ 閉じる×2
   │
   └─ 次の開催日へ
```

## 🎯 今すぐやること

### ステップ1: JVオッズ取得ボタンを追加

Power Automate for Desktopで:
1. ステップ12（コメント）とステップ13の間をクリック
2. 「ウィンドウ内のボタンを押す」アクションを追加
3. JVオッズ取得ボタンを選択

### ステップ2: 待機を追加

JVオッズ取得の直後に「待機 30秒」を追加

### ステップ3: テスト実行

修正後、フローを実行して1レース分が正しく動作するか確認

---

**まずはステップ1（JVオッズ取得ボタンの追加）から始めてください！**

どこで困ったら教えてください。

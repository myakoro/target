# TARGET時系列オッズ手動取得手順

このドキュメントは、TARGETソフトウェアで時系列オッズを手動取得する手順を記録します。
自動化スクリプト作成の参考資料として使用します。

## 事前準備

### TARGET環境設定
1. TARGETを起動
2. メニュー: `環境設定` → `各種設定`
3. `時系列オッズCSV形式出力用フォルダ` を設定
   - 推奨: `C:\Users\takuy\Desktop\投資競馬アプリ系\target系\output`
4. 設定を保存

## 手動取得手順

### ステップ1: レース検索
- [ ] TARGETメインメニューから `レース検索` を選択
- [ ] 検索条件設定画面が表示される

### ステップ2: 日付範囲の指定
- [ ] `開催日` タブを選択
- [ ] `開始日` に取得開始日を入力（例: 2024/01/01）
- [ ] `終了日` に取得終了日を入力（例: 2024/01/31）
- [ ] その他の条件は必要に応じて設定

### ステップ3: 検索実行
- [ ] `検索` ボタンをクリック
- [ ] 検索結果一覧が表示されるまで待機（数秒～数十秒）
- [ ] 対象レース数を確認

### ステップ4: レース選択
- [ ] `全選択` ボタンをクリック（または個別にレースを選択）
- [ ] 選択されたレース数を確認

### ステップ5: 時系列オッズのダウンロード
- [ ] メニュー: `ファイル` → `時系列オッズのダウンロード`
- [ ] ダウンロード確認ダイアログが表示される
- [ ] `OK` をクリック
- [ ] ダウンロード進行状況を確認
- [ ] 完了メッセージが表示されるまで待機（レース数により数分～数十分）

**注意:** 
- ダウンロード中はTARGETを操作しない
- レース数が多い場合は時間がかかる
- ネットワーク接続が必要

### ステップ6: 出馬表画面への移動
- [ ] 検索結果一覧から任意のレースをダブルクリック
- [ ] 出馬表画面が表示される
- [ ] または、メニュー: `出馬表` → `レース選択`

### ステップ7: CSV一括出力
- [ ] 出馬表画面で、メニュー: `ファイル` → `時系列オッズCSV出力`
- [ ] または、出馬表レース選択画面で `CSV出力` ボタン
- [ ] CSV出力設定ダイアログが表示される

### ステップ8: 出力設定
- [ ] 出力対象: `選択したレース` または `全レース`
- [ ] 出力条件: 
  - `全時点` または
  - `発走○分前` または
  - `確定オッズのみ`
- [ ] 出力先フォルダ: 環境設定で指定したフォルダが表示される
- [ ] `OK` をクリック

### ステップ9: 出力完了確認
- [ ] 出力完了メッセージが表示される
- [ ] 出力先フォルダを開く
- [ ] CSVファイルが生成されていることを確認
- [ ] ファイル数とサイズを確認

## 出力ファイル形式

### ファイル名
```
<レースID>.csv
例: 2024010607010101.csv
```

### ファイル構造（Shift-JIS、横持ち形式）
```
レースID,区分,月日時分,頭数,単勝票数,複勝票数,1単,1複Lo,1複Hi,2単,2複Lo,2複Hi,...
2024010607010101,1,01061000,16,100,200,3.5,1.2,1.5,8.2,2.1,3.0,...
2024010607010101,1,01061005,16,150,250,3.4,1.2,1.4,8.0,2.0,2.9,...
...
```

### データ項目
- **レースID**: 年月日場R（12桁）
- **区分**: データ区分（1=通常）
- **月日時分**: タイムスタンプ（MMDDHHmm）
- **頭数**: 出走頭数
- **単勝票数**: 単勝投票数
- **複勝票数**: 複勝投票数
- **N単**: N番馬の単勝オッズ
- **N複Lo**: N番馬の複勝オッズ下限
- **N複Hi**: N番馬の複勝オッズ上限

## トラブルシューティング

### 時系列オッズがダウンロードできない
**原因:**
- JRA-VANへの接続エラー
- データが存在しない期間を指定
- JRA-VAN契約の問題

**対処:**
1. ネットワーク接続を確認
2. JRA-VAN Data Labの契約状態を確認
3. 対象期間を確認（古すぎるデータは提供されていない可能性）

### CSV出力されない
**原因:**
- 時系列オッズがダウンロードされていない
- 出力フォルダの権限エラー
- ディスク容量不足

**対処:**
1. 先にステップ5を完了させる
2. 出力先フォルダの書き込み権限を確認
3. ディスク空き容量を確認

### ファイルが文字化けする
**原因:**
- エンコーディングの問題（Shift-JIS）

**対処:**
- Shift-JIS対応のエディタで開く
- Pythonで読み込む場合: `encoding='shift_jis'`

## 所要時間の目安

| レース数 | ダウンロード時間 | CSV出力時間 | 合計 |
|---------|----------------|------------|------|
| 1日分（約36レース） | 2-5分 | 10-30秒 | 3-6分 |
| 1週間分（約250レース） | 10-20分 | 1-2分 | 12-22分 |
| 1ヶ月分（約1000レース） | 30-60分 | 3-5分 | 35-65分 |

※ ネットワーク速度やPC性能により変動

## 次のステップ

この手順を元に、以下の自動化を実装:

1. **Python + PyAutoGUI**: 画面操作の自動化
2. **Power Automate for Desktop**: より安定した自動化
3. **タスクスケジューラ**: 定期実行の設定

## スクリーンショット記録欄

自動化実装時に、以下の画面のスクリーンショットを撮影して添付:

- [ ] レース検索画面
- [ ] 日付範囲入力フィールド
- [ ] 検索結果一覧
- [ ] 時系列オッズダウンロードメニュー
- [ ] CSV出力設定ダイアログ
- [ ] 出力完了メッセージ

**スクリーンショット保存先:** `C:\Users\takuy\Desktop\投資競馬アプリ系\target系\screenshots\`

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|---------|--------|
| 2024-12-14 | 初版作成 | AI |
